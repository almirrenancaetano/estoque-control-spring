<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Usuários</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" crossorigin="anonymous">
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Sistema de Estoque</a>
        <span class="navbar-text">
            <a href="/logout" class="link-light text-decoration-none">Sair</a>
        </span>
    </div>
</nav>

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Usuários</h2>
        <a href="/users/new" class="btn btn-primary">Novo usuário</a>
    </div>

    <!-- ALERTAS -->
    <div th:if="${message}" class="alert alert-dismissible fade show mb-3"
         th:classappend="${messageType} == 'danger' ? ' alert-danger' : ' alert-success'" role="alert">
        <span th:text="${message}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="card">
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Usuário</th>
                    <th>Perfil</th>
                    <th class="text-center">Ações</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="4" class="text-center py-3">
                        Nenhum usuário cadastrado.
                    </td>
                </tr>
                <tr th:each="u : ${users}">
                    <td th:text="${u.id}"></td>
                    <td th:text="${u.username}"></td>
                    <td th:text="${u.role == 'ROLE_ADMIN' ? 'Administrador' : 'Usuário'}"></td>
                    <td class="text-center">
                        <a th:href="@{'/users/edit/' + ${u.id}}"
                           class="btn btn-sm btn-outline-secondary me-1">
                            Editar
                        </a>

                        <!-- botão abre modal de confirmação -->
                        <button type="button"
                                class="btn btn-sm btn-outline-danger"
                                th:onclick="|openDeleteModal(${u.id})|">
                            Excluir
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <a href="/" class="mt-3 d-inline-block">Voltar para Home</a>
</div>

<!-- MODAL DE CONFIRMAÇÃO DE EXCLUSÃO DE USUÁRIO -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirmar exclusão</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                Tem certeza que deseja excluir este usuário?
                <br><small>Esta ação não pode ser desfeita.</small>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Excluir</a>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>

<script th:inline="javascript">
    function openDeleteModal(id) {
        const baseUrl = /*[[@{/users/delete/}]]*/ '/users/delete/';
        const url = baseUrl + id;
        document.getElementById('confirmDeleteBtn').setAttribute('href', url);

        const modal = new bootstrap.Modal(document.getElementById('deleteUserModal'));
        modal.show();
    }
</script>

</body>
</html>
